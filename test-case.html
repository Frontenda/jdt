<script src="http://code.jquery.com/jquery-latest.min.js"></script>

<script>

var json_data = { 
	'library' : {
		'statistics' : { 'books-count':10, 'currently-reading':'madness.txt'},
		'books' : [
			{'name' : 'Amber 1', 'authors' : ['Zheliazny', 'Plasmazny','Zemlianyj'], 'summary':'The Amber story - book 1', 'genre' : 'science-fiction'},
			{'name' : 'Amber 2', 'authors' : ['Zheliazny'], 'summary':'The Amber story - book 2', 'genre' : 'science-fiction'},
			{'name' : 'Amber 3', 'authors' : ['Zheliazny'], 'summary':'The Amber story - book 3', 'genre' : 'science-fiction'},
			{'name' : 'Amber 4', 'authors' : ['Zheliazny'], 'summary':'The Amber story - book 4', 'genre' : 'science-fiction'},
			{'name' : 'Amber 5', 'authors' : ['Zheliazny'], 'summary':'The Amber story - book 5', 'genre' : 'science-fiction'}
		],
		'shelfs' : [],
		'a-nema' : 'takogo'
	},
}

var JDT = {

	process : function(data) {
		this.process_map(data, document.body);
	},

	process_map: function (data, parent) {
		console.log('process_map', data, parent)
		var wrapper = this;
		jQuery.each(data, function(key, value){
			wrapper.process_element(value, wrapper.find_closest_child(parent, key));
		})	
	},


	process_array: function (array, parent) {
		var list_object = this.find_closest_child(parent, 'list');
		// list class is not defined. Use parent as list class
		if ( typeof list_object == 'undefined') {
			list_object = parent
		}

		var item_templates = this.find_closest_childen(list_object, 'item');
		if ( item_templates.length < 1 ) {
			console.log("ERROR: object", parent, "doesn't contains an element with css class 'item'")
			throw "sopping execution, check console.log"
		}
		var item_template = item_templates[0];
		var item_parent = item_template.parentNode;
		jQuery(item_templates).remove();

		var delimiter = jQuery(item_parent).find('>.delimiter');
		delimiter.remove();	

		var wrapper = this;
		jQuery.each(array, function(index, value){
			var item = jQuery(item_template).clone()[0];
			 wrapper.process_element(value, item);
			if (index > 0 ) jQuery(item_parent).append( jQuery(delimiter).clone());
			jQuery(item_parent).append(item);
		})	

	},

	process_element: function (value, parent) {
		if ( typeof parent == 'undefined' ) return; // nothing to do. We don't have an element for the json
	
		if ( value instanceof Array) this.process_array(value, parent)
		else if ( value instanceof Object) this.process_map(value, parent)
		else this.process_value(value, parent)
	},


	process_value: function (value, parent) {
		var value_object = jQuery(parent).find('.value');
		var text_container = value_object.length>0 ? value_object[0] : parent;
		jQuery(text_container).text(value);
	},


	find_closest_childen: function (parent, key) {
		// if parent has the class itself, let's return it right away
		if ( jQuery(parent).hasClass(key))  return [parent];

		var children = jQuery(parent).find('.'+key)

		// has one child ?
		if (children.length <= 1) return children;
	
		// let's find only closest depth children is to the parent
		var closest = [];
		var iterated_parent_nodes = jQuery(children); // clone
		while ( closest.length == 0 ) {

			// every iteration will go up 1 parentNode and search for children with parentNode == parent
			jQuery( iterated_parent_nodes ).each( function( index, previous_parent_node ) {
				var current_parent_node = previous_parent_node.parentNode;

				if ( current_parent_node == parent ) closest[closest.length++] = children[index];
			
				// set next iteration of parent_node for element
				iterated_parent_nodes[index] = current_parent_node;
			} )

		}
	
		return closest;
	}, 
	
	find_closest_child: function (parent, key) {
		var children = this.find_closest_childen(parent, key);

		if ( children.length > 1 ) {
			console.log('ERROR: you have more than one element for parent: ', parent, ' with class: ', key, '. Consider refactoring your HTML or JSON structure');
			throw "stopping execution, check console.log"
		}

		return children[0];
	}
}

$(function(){ JDT.process(json_data); });
</script>


<style>

	div.library { border : 2px solid black }
	div.library .statistics { border : 1px solid red }
	table.books { border : 1px solid black; width : 100%; }
	table.books .book .name span { font-weight : bold; color : red; }
	table.books .book .authors em { font-style : italic; color : green; }

</style>

<div class="library">
	
<div class="statistics">
 I have <span class="books-count">0</span> books in my collection and i am currently reading : <span class="currently-reading">a book</span>
</div>

<table class="books">
<tr class="listing-header">
	<th>name</th>
	<th>author</th>
	<th>summary</th>
	<th>genre</th>
</tr>
<tr class="book item">
	<td class="name"><span class="value">My Book</span><span class="item">wtf</span></td>
	<td class="authors"><em class="item">Vasil Pupkin</em><span class="delimiter">,</span></td>
	<td class="summary">It's a perfect book to fall asleep</td>
	<td class="genre">Sleper</td>
</tr>
<tr class="book item">
	<td class="name"><span class="value">His Book</span><span class="item">wtf</span></td>
	<td class="authors"><em class="item">Diadia Bubkin</em><span class="delimiter">,</span></td>
	<td class="summary">It's the shittest book to fall asleep</td>
	<td class="genre">Fucker</td>
</tr>
</table>

</div>